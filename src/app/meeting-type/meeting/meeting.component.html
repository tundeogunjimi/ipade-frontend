
<div class="container mt-5">
  <div class="row">
    <div class="col-sm-12 border p-3">
      <ul class="nav nav-underline" id="settingsTab" role="tablist">
        <li class="nav-item me-3" role="presentation">
          <a
            class="nav-link active"
            id="meeting-types-tab"
            data-bs-toggle="tab"
            href="#meeting-types"
            role="tab"
            aria-controls="meeting-types"
            aria-selected="true"
          >
            Meeting Types
          </a>
        </li>
        <li class="nav-item" role="presentation">
          <a
            class="nav-link"
            id="scheduled-meetings-tab"
            data-bs-toggle="tab"
            href="#scheduled-meetings"
            role="tab"
            aria-controls="scheduled-meetings"
            aria-selected="false"
          >
            Scheduled Meetings
          </a>
        </li>
      </ul>

      <div class="tab-content my-4" id="settingsTabContent">
        <div class="tab-pane fade show active" id="meeting-types" role="tabpanel" aria-labelledby="meeting-types-tab">
          <div class="row">
            <div class="col-md-4 col-sm-12">
              <p class="lead fw-medium text-center text-primary">My Meetings</p>
              <p-scrollPanel [style]="{ width: '100%', height: '70vh' }" styleClass="custombar1">

                <div *ngIf="!isMeetingFetched" class="spinner text-center">
                  <p-progressSpinner></p-progressSpinner>
                </div>

                <ng-container *ngIf="isMeetingFetched">
                  <ng-container *ngIf="meetings.length > 0; else noMeetingFound">
                    <div class="card mb-2" *ngFor="let meeting of meetings">
                      <div class="card-body meeting-card">
                        <div class="row">
                          <div class="col-sm-8">
                            <span class="lead text-primary fw-medium">{{ meeting.name | titlecase }}</span>
                          </div>
                          <div class="col-sm-4 text-end">
                            <span class="text-primary fw-medium">{{ meeting.price | currency: 'N'}}</span>
                          </div>
                          <div class="col-sm-12">
                            <span class="text-muted">
                              <span class="p-1">{{ meeting.duration }} Minutes,</span>
                              <span>{{ meeting.location | titlecase }}</span>
                            </span>
                          </div>
                        </div>
                        <div class="row text-end">
                          <div class="col-sm-8 offset-md-4 pt-1 action-icons">
                            <i class="pi pi-pencil"  (click)="selectMeeting(meeting)"></i>
                            <i class="pi pi-copy"></i>
                            <i class="pi pi-share-alt"></i>
                            <i
                              class="pi pi-trash text-danger"
                              data-bs-toggle="modal"
                              data-bs-target="#deleteModal"
                              (click)="prepareForDelete(meeting)"
                            ></i>
                          </div>
                        </div>
                      </div>
                    </div>
                  </ng-container>
                  <ng-template #noMeetingFound>
                    <p class="text-center mt-5">No meeting found...</p>
                  </ng-template>
                </ng-container>
              </p-scrollPanel>
            </div>
            <div class="col-md-8 col-sm-12">
              <ng-container *ngIf="meetingType === 'paid'">
                <p class="lead fw-medium text-center text-primary">New Meeting</p>
                <form [formGroup]="meetingForm" class="border p-3">
                  <div class="row">
                    <div class="mb-3 col-md-8">
                      <div class="text-danger" *ngIf="formErrors?.name">{{ formErrors?.name }}</div>
                      <label for="name" class="form-label">Meeting Name</label>
                      <input
                        formControlName="name"
                        type="text" class="form-control"
                        id="name"
                        placeholder="Medical Consultation, Marriage Counseling..."
                        (focusout)="createUrl()"
                        (focusin)="clearError('name')"
                      >
                    </div>
                    <div class=" mb-3 col-md-4">
                      <div class="text-danger" *ngIf="formErrors?.duration">{{ formErrors?.duration }}</div>
                      <label for="duration" class="form-label">Duration</label>
                      <select formControlName="duration" class="form-select" id="duration" aria-label="Default select example" (focusin)="clearError('duration')">
                        <option selected>Duration</option>
                        <option value="30">30 min</option>
                        <option value="45">45 min</option>
                        <option value="60">60 min</option>
                        <option value="90">1 hr 30 min</option>
                        <option value="120">2 hrs</option>
                      </select>
                    </div>

                    <div class="mb-3 col-md-4">
                      <div class="text-danger" *ngIf="formErrors?.location">{{ formErrors?.location }}</div>
                      <label for="desc" class="form-label">Location</label>
                      <select
                        formControlName="location"
                        class="form-select" id="desc"
                        aria-label="Default select example"
                        (focusin)="clearError('location')"
                        (change)="checkLocationValue()"
                      >
                        <option selected>Location</option>
                        <option *ngFor="let location of locations" [value]="location.value">{{ location.name }}</option>
                      </select>
                    </div>
                    <div class="mb-3 col-md-4">
                      <div class="text-danger" *ngIf="formErrors?.dateRange">{{ formErrors?.dateRange }}</div>
                      <label for="date-range" class="form-label">Date Range</label>
                      <p-calendar
                        formControlName="dateRange"
                        selectionMode="range"
                        id="date-range"
                        [readonlyInput]="true"
                        (focusin)="clearError('dateRange')"
                      ></p-calendar>
                    </div>
                    <div class="mb-3 col-md-4">
                      <div class="text-danger" *ngIf="formErrors?.price">{{ formErrors?.price }}</div>
                      <label for="amount" class="form-label">Price</label>
                      <input formControlName="price" type="number" class="form-control" id="amount" placeholder="" (focusin)="clearError('price')">
                    </div>
                    <ng-container *ngIf="shouldShowAddressField">
                      <div class="mb-3">
                        <label for="address" class="form-label">Address</label>
                        <textarea formControlName="address" class="form-control" id="address" rows="1"></textarea>
                      </div>
                    </ng-container>
                    <div class="mb-3">
                      <div class="text-danger" *ngIf="formErrors?.desc">{{ formErrors?.desc }}</div>
                      <label for="desc" class="form-label">Description</label>
                      <textarea formControlName="desc" class="form-control" id="desc" rows="3"></textarea>
                    </div>
                    <div class="mb-3">
                      <label for="link" class="form-label">Meeting link</label>
                      <input formControlName="link" type="text" class="form-control" id="link" placeholder="/url-link">
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-sm-12 text-end">
                      <button class="btn btn-primary" (click)="saveMeeting()">{{ saveButtonTxt }} Meeting</button>
                    </div>
                  </div>
                </form>
              </ng-container>
            </div>
          </div>
        </div>

        <div class="tab-pane fade" id="scheduled-meetings" role="tabpanel" aria-labelledby="scheduled-meetings-tab">
          <div class="row">
            <app-scheduled-meetings></app-scheduled-meetings>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>

<!-- Delete Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteAccountLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5 text-danger" id="deleteAccountLabel">Are you sure?</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p class="lead fw-medium">Are you sure you want to delete this meeting? <br>
          This action cannot be reversed.</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-danger" (click)="deleteMeeting()" data-bs-dismiss="modal">Delete Account</button>
      </div>
    </div>
  </div>
</div>
